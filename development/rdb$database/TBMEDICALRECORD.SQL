/*
    TBMEDICALRECORD: TABLE FOR STORING MEDICAL RECORDS
*/

CREATE TABLE TBMEDICALRECORD (
    ID_ SERIAL NOT NULL PRIMARY KEY,
    NUMBER VARCHAR(8), 

    DATE_OPEN DATE,
    DATE_CLOSE DATE,

    IDCUSTOMER_ INTEGER NOT NULL,
    IDPSYCHOLOGIST_ INTEGER,
    IDSUPERVISOR_ INTEGER, 

    IDSERVICE_ INTEGER,
    IDREFERRAL_IN_ INTEGER,
    IDREFERRAL_OUT_ INTEGER,

    OBSERVATION VARCHAR(255),

    FOREIGN KEY (IDCUSTOMER_) REFERENCES TBCUSTOMER (ID_),
    FOREIGN KEY (IDPSYCHOLOGIST_) REFERENCES TBCOLLABORATOR (ID_),
    FOREIGN KEY (IDSUPERVISOR_) REFERENCES TBCOLLABORATOR (ID_),
    
    FOREIGN KEY (IDSERVICE_) REFERENCES TBSERVICE (ID_),
    FOREIGN KEY (IDREFERRAL_IN_) REFERENCES TBREFERRAL (ID_),
    FOREIGN KEY (IDREFERRAL_OUT_) REFERENCES TBREFERRAL (ID_)
);

COMMIT WORK;

COMMENT ON TABLE TBMEDICALRECORD IS 'TABLE FOR STORING MEDICAL RECORDS';
COMMENT ON COLUMN TBMEDICALRECORD.NUMBER IS 'UNIQUE NUMBER ASSIGNED TO THE MEDICAL RECORD';

COMMENT ON COLUMN TBMEDICALRECORD.DATE_OPEN IS 'DATE WHEN THE MEDICAL RECORD WAS OPENED';
COMMENT ON COLUMN TBMEDICALRECORD.DATE_CLOSE IS 'DATE WHEN THE MEDICAL RECORD WAS CLOSED';

COMMENT ON COLUMN TBMEDICALRECORD.IDCUSTOMER_ IS 'FOREIGN KEY REFERENCING THE CUSTOMER';
COMMENT ON COLUMN TBMEDICALRECORD.IDPSYCHOLOGIST_ IS 'FOREIGN KEY REFERENCING THE PSYCHOLOGIST';
COMMENT ON COLUMN TBMEDICALRECORD.IDSUPERVISOR_ IS 'FOREIGN KEY REFERENCING THE SUPERVISOR';

COMMENT ON COLUMN TBMEDICALRECORD.IDSERVICE_ IS 'FOREIGN KEY REFERENCING THE SERVICE';
COMMENT ON COLUMN TBMEDICALRECORD.IDREFERRAL_IN_ IS 'FOREIGN KEY REFERENCING THE INCOMING REFERRAL';
COMMENT ON COLUMN TBMEDICALRECORD.IDREFERRAL_OUT_ IS 'FOREIGN KEY REFERENCING THE OUTGOING REFERRAL';

COMMENT ON COLUMN TBMEDICALRECORD.OBSERVATION IS 'ADDITIONAL OBSERVATIONS REGARDING THE MEDICAL RECORD';

COMMIT WORK;
