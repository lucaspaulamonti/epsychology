CREATE TABLE IF NOT EXISTS DRUGADDICTION (
    ID INTEGER,
    ID_CUSTOMER INTEGER,
    AXCOHOL INTEGER,
    TXBACCO INTEGER,
    MXRIHUANA INTEGER,
    EXSTASY INTEGER,
    LXD INTEGER,
    CXCAINE INTEGER,
    CXACK INTEGER,
    HXROIN INTEGER,
    OXIUM INTEGER,
    AXPHETAMINE INTEGER,
    OBSERVATION VARCHAR(255),
	
	CONSTRAINT PK_DRUGADDICTION__ID PRIMARY KEY (ID),
	CONSTRAINT UQ_DRUGADDICTION__ID_CUSTOMER UNIQUE (ID_CUSTOMER),
	CONSTRAINT NN_DRUGADDICTION__ID_CUSTOMER CHECK (ID_CUSTOMER IS NOT NULL),
	CONSTRAINT FK_DRUGADDICTION_CUSTOMER__ID FOREIGN KEY (ID_CUSTOMER) REFERENCES CUSTOMER(ID),

	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__AXCOHOL FOREIGN KEY (AXCOHOL) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__TXBACCO FOREIGN KEY (TXBACCO) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__MXRIHUANA FOREIGN KEY (MXRIHUANA) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__EXSTASY FOREIGN KEY (EXSTASY) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__LXD FOREIGN KEY (LXD) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__CXCAINE FOREIGN KEY (CXCAINE) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__CXACK FOREIGN KEY (CXACK) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__HXROIN FOREIGN KEY (HXROIN) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__OXIUM FOREIGN KEY (OXIUM) REFERENCES USEFREQUENCY(ID),
	CONSTRAINT FK_DRUGADDICTION_USEFREQUENCY__AXPHETAMINE FOREIGN KEY (AXPHETAMINE) REFERENCES USEFREQUENCY(ID)
);

CREATE SEQUENCE IF NOT EXISTS SQ_DRUGADDICTION__ID;

ALTER SEQUENCE SQ_DRUGADDICTION__ID RESTART WITH 1;

CREATE OR REPLACE FUNCTION BI_DRUGADDICTION__ID()
RETURNS TRIGGER AS
$$
BEGIN
  IF NEW.ID IS NULL THEN
    NEW.ID := NEXTVAL('SQ_DRUGADDICTION__ID');
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE PLPGSQL;

CREATE OR REPLACE TRIGGER BI_DRUGADDICTION__ID
BEFORE INSERT ON DRUGADDICTION
FOR EACH ROW
EXECUTE FUNCTION BI_DRUGADDICTION__ID();
