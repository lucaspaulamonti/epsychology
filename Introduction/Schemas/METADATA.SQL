CREATE TABLE IF NOT EXISTS METADATA (
	ID INTEGER,
	SCHEMA VARCHAR(65),
	COMMENT VARCHAR(255),

	CONSTRAINT PK_METADATA__ID PRIMARY KEY (ID),
	CONSTRAINT UQ_METADATA__SCHEMA UNIQUE (SCHEMA),
	CONSTRAINT NN_METADATA__SCHEMA CHECK (SCHEMA IS NOT NULL)
);

CREATE SEQUENCE IF NOT EXISTS SQ_METADATA__ID;

ALTER SEQUENCE SQ_METADATA__ID RESTART WITH 1;

CREATE OR REPLACE FUNCTION BI_METADATA__ID()
RETURNS TRIGGER AS
$$
BEGIN
  IF NEW.ID IS NULL THEN
    NEW.ID := NEXTVAL('SQ_METADATA__ID');
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE PLPGSQL;

CREATE OR REPLACE TRIGGER BI_METADATA__ID
BEFORE INSERT ON METADATA
FOR EACH ROW
EXECUTE FUNCTION BI_METADATA__ID();
